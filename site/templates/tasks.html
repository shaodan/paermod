{% extends "layout.html" %}
{% set active_page = "tasks" %}
{% block content %}

    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        运行状态
        <small>任务列表</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="/"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">TasksPage</li>
      </ol>
    </section>
    <!-- Main content -->
    <section class="content">
      <!-- Small boxes (Stat box) -->
      <div class="row">
        <div class="col-xs-12">
          <div class="box">
            <div class="box-header">
              <h3 class="box-title">任务列表</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <table id='datatable' class="table table-bordered table-hover">
              </table>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
      </div>
    </section>
    <!-- /.content -->
{% endblock %}
{% block script %}
<!-- AdminLTE App -->
<script src="{{macro.static_url("dist/js/app.min.js")}}"></script>
<!-- DataTables -->
<script src="{{macro.static_url("plugins/datatables/jquery.dataTables.min.js")}}"></script>
<script src="{{macro.static_url("plugins/datatables/dataTables.bootstrap.min.js")}}"></script>

<!-- page script -->
<script type="text/javascript">
  $(document).ready(function() {
    var table = $('#datatable').DataTable( {
      ajax: {
        url : 'http://166.111.42.35:3003/running',
        type: 'GET'
      },
      columns: [
          { title: "Task", data:  'name'},
          { title: "Server", data: 'server'},
          { title: "Start", data: 'start'},
          { title: "Duration", data: 'rtime'},
          { title: "State", data: 'state'}
      ],
      "paging": true,
      "lengthChange": false,
      "pageLength": 20,
      "searching": false,
      "ordering": true,
      "info": true,
      "autoWidth": true
    });
    setInterval( function () {
      table.ajax.reload();
    }, 30000 );
  });
</script>
{% endblock %}